(function(f,i,p,u,E,h,v,M,y){"use strict";function A(){return y.useProxy(u.storage),React.createElement(M.ErrorBoundary,null,React.createElement(v.ReactNative.ScrollView,null,React.createElement(M.Forms.FormSwitchRow,{label:"Split messages on words instead of newlines",subLabel:"Results in the lowest amount of messages",onValueChange:function(n){return u.storage.splitOnWords=n},value:u.storage.splitOnWords})))}let c;u.storage.splitOnWords??=!1;function N(n){return new Promise(function(o){return setTimeout(o,n)})}function w(n,o){const t=[];return u.storage.splitOnWords||t.push(n.split(`
`).reduce(function(e,s){return e.length+s.length+2>o?(t.push(e),s+`
`):e?e+s+`
`:s+`
`},"")),t.length&&!t.some(function(e){return e.length>o})?t.map(function(e){return e.trim()}):(t.length=0,t.push(n.split(" ").reduce(function(e,s){return e.length+s.length+2>o?(t.push(e),s+" "):e?e+s+" ":s+" "},"")),t.some(function(e){return e.length>o})?!1:t.map(function(e){return e.trim()}))}var G={onLoad(){const n=i.findByStoreName("ChannelStore"),o=i.findByStoreName("UserStore"),t=i.findByProps("sendMessage","editMessage"),e=i.findByProps("MAX_MESSAGE_LENGTH"),s=t.sendMessage.bind(t),T=async function(d,l,r){const a={invalidEmojis:l.invalidEmojis,validNonShortcutEmojis:l.validNonShortcutEmojis,tts:!1,content:r};if(typeof t._sendMessage=="function"){await t._sendMessage(d,a,{});return}await s(d,a)},S=function(){return o.getCurrentUser()?.premiumType===2?4e3:2e3};e&&(e.MAX_MESSAGE_LENGTH=2**30,e.MAX_MESSAGE_LENGTH_PREMIUM=2**30),c?.(),c=p.before("sendMessage",t,function(d){const[l,r]=d,a=r?.content;if(!a||a.length<=S())return;const _=w(a,S());if(!_){r.content="",h.showToast("Failed to split message",E.getAssetIDByName("Small"));return}const m=_.filter(function(g){return g.length>0});if(!m.length){r.content="",h.showToast("Failed to split message",E.getAssetIDByName("Small"));return}r.content=m.shift()??"";const L=n.getChannel(l);(async function(){for(const g of m)await N(Math.max((L?.rateLimitPerUser??0)*1e3,1e3)),await T(l,r,g)})()})},onUnload:function(){c?.(),c=void 0;const n=i.findByProps("MAX_MESSAGE_LENGTH");n&&(n.MAX_MESSAGE_LENGTH=2e3,n.MAX_MESSAGE_LENGTH_PREMIUM=4e3)},settings:A};return f.default=G,Object.defineProperty(f,"__esModule",{value:!0}),f})({},vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.ui.assets,vendetta.ui.toasts,vendetta.metro.common,vendetta.ui.components,vendetta.storage);
