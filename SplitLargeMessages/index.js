(function(m,c,E,a,p,v,M,y,b){"use strict";function N(){return b.useProxy(a.storage),React.createElement(y.ErrorBoundary,null,React.createElement(M.ReactNative.ScrollView,null,React.createElement(y.Forms.FormSwitchRow,{label:"Split messages on words instead of newlines",subLabel:"Results in the lowest amount of messages",onValueChange:function(s){return a.storage.splitOnWords=s},value:a.storage.splitOnWords})))}let l;const f=new Map;a.storage.splitOnWords??=!1;function j(){f.clear();const s=c.findAll(function(n){return n&&typeof n=="object"&&Object.keys(n).some(function(t){return t.includes("MAX_MESSAGE_LENGTH")})});for(const n of s){const t={};let e=!1;for(const o of Object.keys(n))o.includes("MAX_MESSAGE_LENGTH")&&typeof n[o]=="number"&&(t[o]=n[o],n[o]=2**30,e=!0);e&&f.set(n,t)}}function _(){for(const[s,n]of f)for(const[t,e]of Object.entries(n))s[t]=e;f.clear()}function A(s){return new Promise(function(n){return setTimeout(n,s)})}function O(s,n){const t=[];return a.storage.splitOnWords||t.push(s.split(`
`).reduce(function(e,o){return e.length+o.length+2>n?(t.push(e),o+`
`):e?e+o+`
`:o+`
`},"")),t.length&&!t.some(function(e){return e.length>n})?t.map(function(e){return e.trim()}):(t.length=0,t.push(s.split(" ").reduce(function(e,o){return e.length+o.length+2>n?(t.push(e),o+" "):e?e+o+" ":o+" "},"")),t.some(function(e){return e.length>n})?!1:t.map(function(e){return e.trim()}))}var B={onLoad(){const s=c.findByStoreName("ChannelStore"),n=c.findByStoreName("UserStore"),t=c.findByProps("sendMessage","editMessage"),e=t.sendMessage.bind(t),o=async function(d,u,r){const i={invalidEmojis:u.invalidEmojis,validNonShortcutEmojis:u.validNonShortcutEmojis,tts:!1,content:r};if(typeof t._sendMessage=="function"){await t._sendMessage(d,i,{});return}await e(d,i)},S=function(){return n.getCurrentUser()?.premiumType===2?4e3:2e3};j(),l?.(),l=E.before("sendMessage",t,function(d){const[u,r]=d,i=r?.content;if(!i||i.length<=S())return;const w=O(i,S());if(!w){r.content="",v.showToast("Failed to split message",p.getAssetIDByName("Small"));return}const g=w.filter(function(h){return h.length>0});if(!g.length){r.content="",v.showToast("Failed to split message",p.getAssetIDByName("Small"));return}r.content=g.shift()??"";const L=s.getChannel(u);(async function(){for(const h of g)await A(Math.max((L?.rateLimitPerUser??0)*1e3,1e3)),await o(u,r,h)})()})},onUnload:function(){l?.(),l=void 0,_()},settings:N};return m.default=B,Object.defineProperty(m,"__esModule",{value:!0}),m})({},vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.ui.assets,vendetta.ui.toasts,vendetta.metro.common,vendetta.ui.components,vendetta.storage);
