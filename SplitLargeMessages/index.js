(function(c,o,E,a,h,M,S,f,_){"use strict";function p(){return _.useProxy(a.storage),React.createElement(f.ErrorBoundary,null,React.createElement(S.ReactNative.ScrollView,null,React.createElement(f.Forms.FormSwitchRow,{label:"Split messages on words instead of newlines",subLabel:"Results in the lowest amount of messages",onValueChange:function(n){return a.storage.splitOnWords=n},value:a.storage.splitOnWords})))}let i;a.storage.splitOnWords??=!1;function v(n){return new Promise(function(r){return setTimeout(r,n)})}function A(n,r){const t=[];return a.storage.splitOnWords||t.push(n.split(`
`).reduce(function(e,s){return e.length+s.length+2>r?(t.push(e),s+`
`):e?e+s+`
`:s+`
`},"")),t.length&&!t.some(function(e){return e.length>r})?t.map(function(e){return e.trim()}):(t.length=0,t.push(n.split(" ").reduce(function(e,s){return e.length+s.length+2>r?(t.push(e),s+" "):e?e+s+" ":s+" "},"")),t.some(function(e){return e.length>r})?!1:t.map(function(e){return e.trim()}))}var G={onLoad(){const n=o.findByStoreName("ChannelStore"),r=o.findByStoreName("UserStore"),t=o.findByProps("sendMessage","editMessage"),e=o.findByProps("MAX_MESSAGE_LENGTH"),s=t.sendMessage.bind(t),g=function(){return r.getCurrentUser()?.premiumType===2?4e3:2e3};e&&(e.MAX_MESSAGE_LENGTH=2**30,e.MAX_MESSAGE_LENGTH_PREMIUM=2**30),i?.(),i=E.before("sendMessage",t,function(y){const[m,u]=y,l=u?.content;if(!l||l.length<g())return;const d=A(l,g());if(!d){u.content="",M.showToast("Failed to split message",h.getAssetIDByName("Small"));return}u.content=d.shift()??"";const w=n.getChannel(m);(async function(){for(const N of d)await v(Math.max((w?.rateLimitPerUser??0)*1e3,1e3)),await s(m,{...u,tts:!1,content:N})})()})},onUnload:function(){i?.(),i=void 0;const n=o.findByProps("MAX_MESSAGE_LENGTH");n&&(n.MAX_MESSAGE_LENGTH=2e3,n.MAX_MESSAGE_LENGTH_PREMIUM=4e3)},settings:p};return c.default=G,Object.defineProperty(c,"__esModule",{value:!0}),c})({},vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.ui.assets,vendetta.ui.toasts,vendetta.metro.common,vendetta.ui.components,vendetta.storage);
