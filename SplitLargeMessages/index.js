(function(m,u,w,f,E,M,O,b,C){"use strict";function W(){return C.useProxy(f.storage),React.createElement(b.ErrorBoundary,null,React.createElement(O.ReactNative.ScrollView,null,React.createElement(b.Forms.FormSwitchRow,{label:"Split messages on words instead of newlines",subLabel:"Results in the lowest amount of messages",onValueChange:function(i){return f.storage.splitOnWords=i},value:f.storage.splitOnWords})))}let h;const g=new Map,v=[],j=new WeakSet;let y;f.storage.splitOnWords??=!1;function _(){g.clear();const i=u.findAll(function(n){return n&&typeof n=="object"&&Object.keys(n).some(function(e){return e.includes("MAX_MESSAGE_LENGTH")})});for(const n of i){const e={};let t=!1;for(const a of Object.keys(n))a.includes("MAX_MESSAGE_LENGTH")&&typeof n[a]=="number"&&(e[a]=n[a],n[a]=2**30,t=!0);t&&g.set(n,e)}}function I(){for(const[i,n]of g)for(const[e,t]of Object.entries(n))i[e]=t;g.clear()}function R(i){return new Promise(function(n){return setTimeout(n,i)})}function T(i,n){if(!n?.getDraft)return"";try{const e=n.getDraft(i,0);if(typeof e=="string")return e}catch{}try{const e=n.getDraft(i);if(typeof e=="string")return e}catch{}return""}function A(i,n){const e=[];return f.storage.splitOnWords||e.push(i.split(`
`).reduce(function(t,a){return t.length+a.length+2>n?(e.push(t),a+`
`):t?t+a+`
`:a+`
`},"")),e.length&&!e.some(function(t){return t.length>n})?e.map(function(t){return t.trim()}):(e.length=0,e.push(i.split(" ").reduce(function(t,a){return t.length+a.length+2>n?(e.push(t),a+" "):t?t+a+" ":a+" "},"")),e.some(function(t){return t.length>n})?!1:e.map(function(t){return t.trim()}))}var L={onLoad(){const i=u.findByStoreName("ChannelStore"),n=u.findByStoreName("SelectedChannelStore"),e=u.findByStoreName("UserStore"),t=u.findByProps("sendMessage","editMessage"),a=u.findByProps("getDraft"),N=u.findByProps("clearDraft","saveDraft"),B=u.findByProps("clearAll"),G=t.sendMessage.bind(t),D=async function(s,o,r){const c={invalidEmojis:o.invalidEmojis,validNonShortcutEmojis:o.validNonShortcutEmojis,tts:!1,content:r};if(typeof t._sendMessage=="function"){await t._sendMessage(s,c,{});return}await G(s,c)},p=function(){return e.getCurrentUser()?.premiumType===2?4e3:2e3},U=async function(s,o){for(const r of o)await D(s,{},r)},k=function(s,o){const r=s?.channel?.id??s?.channelId??n?.getChannelId?.();if(!r)return o(s);const c=(typeof s?.content=="string"?s.content:"")||(typeof s?.text=="string"?s.text:"")||T(r,a);if(!c||c.length<=p())return o(s);const l=A(c,p());if(!l?.length)return o(s);U(r,l.filter(function(d){return d.length>0}));try{N?.clearDraft?.(r,0)}catch{}try{N?.clearDraft?.(r)}catch{}try{B?.clearAll?.(r,0)}catch{}try{B?.clearAll?.(r)}catch{}return{shouldClear:!1,shouldRefocus:!0}},P=function(){const s=u.findAll(function(o){return o&&typeof o=="object"&&typeof o.openWarningPopout=="function"});for(const o of s)if(!j.has(o)){j.add(o);try{v.push(w.instead("openWarningPopout",o,function([r],c){return k(r,c)}))}catch{}}};_(),P(),y=setInterval(P,3e3),h?.(),h=w.before("sendMessage",t,function(s){const[o,r]=s,c=r?.content;if(!c||c.length<=p())return;const l=A(c,p());if(!l){r.content="",M.showToast("Failed to split message",E.getAssetIDByName("Small"));return}const d=l.filter(function(S){return S.length>0});if(!d.length){r.content="",M.showToast("Failed to split message",E.getAssetIDByName("Small"));return}r.content=d.shift()??"";const x=i.getChannel(o);(async function(){for(const S of d)await R(Math.max((x?.rateLimitPerUser??0)*1e3,1e3)),await D(o,r,S)})()})},onUnload:function(){for(h?.(),h=void 0,y&&(clearInterval(y),y=void 0);v.length;)try{v.pop()?.()}catch{}I()},settings:W};return m.default=L,Object.defineProperty(m,"__esModule",{value:!0}),m})({},vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.ui.assets,vendetta.ui.toasts,vendetta.metro.common,vendetta.ui.components,vendetta.storage);
